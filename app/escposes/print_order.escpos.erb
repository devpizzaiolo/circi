<%= !@order.is_asap ? text(ApplicationController.helpers.bold_text_for_print("******************************************\n"), font_size: FONT_BIG) : nil %><% if @order.for_pickup? %><%= text(@order.is_asap ? "Pickup at:" : "Scheduled Pickup:", :font_size => FONT_BIG) %><% else %><%= text(@order.is_asap ? "Deliver by:" : "Scheduled Delivery:", :font_size => FONT_BIG) %><% end %>
<%= text(@order.to_be_ready_dates_string_for_print_date_only, :font_size => FONT_BIG) %>
<%= text(@order.to_be_ready_dates_string_for_print_time_only, :font_size => FONT_BIG) %><%= !@order.is_asap ? text(ApplicationController.helpers.bold_text_for_print("\n******************************************"), font_size: FONT_BIG) : nil %>

<%= text(ApplicationController.helpers.bold_text_for_print("Order ID:")) %>
<%= text(@order.id.to_s) %>

<%= text(ApplicationController.helpers.bold_text_for_print("Order placed on:")) %>
<%= text(@order.ordered_at_formatted) %>

<% if @order.for_pickup? %><%= text(ApplicationController.helpers.bold_text_for_print("Customer:")) %><% else %><%= text(ApplicationController.helpers.bold_text_for_print("Customer:")) %><% end %>
<%= text("#{@order.first_name} #{@order.last_name}") %>

<% if @order.for_pickup? %><%= text(@order.contact_phone_number) %><% else %><%= text("#{ApplicationController.helpers.bold_text_for_print(@order.delivery_address_1)}, #{ApplicationController.helpers.bold_text_for_print(@order.delivery_address_2)}\n#{@order.delivery_city}\n#{@order.delivery_postal_code}\n#{@order.phone_number}", :font_size => FONT_BIG) %><% end %>

<%= single_splitline %><% unless @order.order_additional.blank? || @order.order_additional == 'null' %><% if @order.order_additional['catering_order'] == "1" %><%= text("CATERING ORDER", :font_size => FONT_BIG) %><%= text("\n#{@order.order_additional['catering_order_group_number']} people") %><% end %><% end %><% if @order.pizza_count > 0 %><%= text("\nPizzas (#{ApplicationController.helpers.bold_text_for_print(@order.pizza_count.to_s)}):\n", :font_size => FONT_BIG) %><% count = 0 %><% @order.order_items.where("deal_id IS NOT NULL").group_by(&:deal_id).each do |deal_id, order_items| %><% count += 1 %><%= text(ApplicationController.helpers.bold_text_for_print(ApplicationController.helpers.print_format_keypair("#{count}. #{order_items.first.deal_title.gsub("<br/> ", "")}", "$#{@order.deal_price(deal_id) * order_items.first.quantity.to_i}" ))) %><%= text("\n") %><%= text("Quantity: #{ApplicationController.helpers.bold_text_for_print(order_items.first.quantity)}") %><% order_items.each do |oi| %><% if oi.product_info['product_type'] == "pizza" %><%= text("\n") %><%= text(ApplicationController.helpers.bold_text_for_print(ApplicationController.helpers.print_format_keypair("#{oi.item_title_for_print}", " " ))) %><%= text("#{oi.pizza_size_long_form}\n", :align_type => ALIGN_L) %><%= unless ["cauliflower", "gluten-free"].select{|size_string| oi.product_info['pizza_size'].include?(size_string) }.size > 0 then text("Crust: #{oi.product_info['pizza_crust']}") end %><%= unless ["cauliflower", "gluten-free"].select{|size_string| oi.product_info['pizza_size'].include?(size_string) }.size > 0 then text(", Style: #{oi.product_info['pizza_crust_style']}") end %><%= text("\n") %><%= single_splitline %><%= text("\n") %><% if oi.toppings_print_arr('whole').count > 0 %><% oi.toppings_print_arr('whole').each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><% @pizza_preset = PizzaPreset.find_by_id(oi[:product_info]['pizza_preset_id']) %><%= text("\n") %><% if oi.toppings_print_arr('left').count > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("*** Toppings (Side 1) ***\n"), :align_type => ALIGN_C) %><% oi.toppings_print_arr('left').each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><% if oi.toppings_print_arr('right').count > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("*** Toppings (Side 2) ***\n"), :align_type => ALIGN_C) %><% oi.toppings_print_arr('right').each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><% end %><% end %><% end %><% @order.order_items.where(deal_id: nil).each do |oi| %><% if oi.product_info['product_type'] == "pizza" %><% count += 1 %><%= text("\n") %><%= text(ApplicationController.helpers.bold_text_for_print(ApplicationController.helpers.print_format_keypair("#{count}. #{if oi.custom == true then "CUSTOM PIZZA" else "#{ActionView::Base.full_sanitizer.sanitize(oi.product_info['product_name']) }" end}", "#{oi.price_formatted_with_quantity}" ))) %>
<%= text("#{oi.pizza_size_long_form}\n", :align_type => ALIGN_L) %><%= unless ["cauliflower", "gluten-free"].select{|size_string| oi.product_info['pizza_size'].include?(size_string) }.size > 0 then text("Crust: #{oi.product_info['pizza_crust']}") end %><%= unless ["cauliflower", "gluten-free"].select{|size_string| oi.product_info['pizza_size'].include?(size_string) }.size > 0 then text(", Style: #{oi.product_info['pizza_crust_style']}") end %><%= text(", Special Instructions: #{oi.product_info['special_instructions']}") %><%= text("\n") %><%= text("Quantity: #{ApplicationController.helpers.bold_text_for_print(oi.quantity)}") %><%= text("\n") %><%= single_splitline %><%= text("\n") %><% if oi.toppings_print_arr('whole').count > 0 %><% oi.toppings_print_arr('whole').each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><% @pizza_preset = PizzaPreset.find_by_id(oi[:product_info]['pizza_preset_id']) %><%= text("\n") %><% if oi.toppings_print_arr('left').count > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("*** Toppings (Side 1) ***\n"), :align_type => ALIGN_C) %><% oi.toppings_print_arr('left').each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><% if oi.toppings_print_arr('right').count > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("*** Toppings (Side 2) ***\n"), :align_type => ALIGN_C) %><% oi.toppings_print_arr('right').each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><%= text("\n") %><% if @pizza_preset.present? && @pizza_preset.is_product_combo %><% @product_combo = ProductCombo.find(@pizza_preset.product_combo_id) %><%= text(ApplicationController.helpers.bold_text_for_print("*** Additional items ***\n"), :align_type => ALIGN_C) %><% oi.order_additional_print_arr.each do |order_additional_items| %><%= text(ApplicationController.helpers.print_format_keypair_with_divider("#{order_additional_items[:label]} x #{order_additional_items[:qty].to_i}"," #{((order_additional_items[:qty] * order_additional_items[:price].to_f) > 0 ? ("$#{order_additional_items[:qty] * order_additional_items[:price].to_f}") : 'FREE')}")) %><%= text("\n") %><% end %><% end %><% end %><% end %><% end %>
<% if @order.calzone_count > 0 %><%= text("\nCalzones (#{ApplicationController.helpers.bold_text_for_print(@order.calzone_count.to_s)}):\n", :align_type => ALIGN_L, :font_size => FONT_BIG) %><% count =0 %><% @order.order_items.each do |oi| %><% if oi.product_info['product_type'] == "calzone" %><% count +=1 %><%= text("\n\n") %><%= text(ApplicationController.helpers.bold_text_for_print(ApplicationController.helpers.print_format_keypair("#{count}. Baked Calzone", "#{oi.price_formatted}"))) %><%= text("\n   Crust: #{oi.product_info['calzone_crust']}") %><%= text("\n") %><% if oi.toppings_calzone_print_arr.count > 0 %><%= single_splitline %><%= text("\n") %><% oi.toppings_calzone_print_arr.each do |oil| %><%= text("#{oil[0]}", :align_type => ALIGN_L) %><%= text("#{oil[1]}", :align_type => ALIGN_L) %><%= text("#{oil[2]}", :align_type => ALIGN_R) %><%= text("\n") %><% end %><% end %><% end %><% end %><% end %>
<% unless @order.order_additional.blank? || @order.order_additional == 'null' %><% if @order.beverages_total > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("\nBeverages:\n"), :font_size => FONT_BIG) %><%= single_splitline %><%= text("\n") %><% @order.beverages_summary_print.each do |beverage| %><%= text(ApplicationController.helpers.print_format_keypair("#{beverage[0]}","#{beverage[1]}")) %><%= text("\n") %><% end %><% end %><% if @order.garlic_breads_total > 0 %><%= text("\nGarlic Breads:\n", :font_size => FONT_BIG) %><%= single_splitline %><% @order.garlic_breads_summary_print.each do |garlic_bread| %><%= text(ApplicationController.helpers.print_format_keypair("#{garlic_bread[0]}","#{garlic_bread[1]}")) %><%= text("\n") %><% end %><% end %><% if @order.cannolis_quantity > 0 %><%= text("\nBrookie Cookies:\n", :font_size => FONT_BIG) %><%= single_splitline %><% @order.cannolis_summary_print.each do |cannoli| %><%= text(ApplicationController.helpers.print_format_keypair("#{cannoli[0]}","#{cannoli[1]}")) %><%= text("\n") %><% end %><% end %><% if @order.salads_total > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("\nSalads:\n"), :font_size => FONT_BIG) %><%= single_splitline %><%= text("\n") %><% @order.salads_summary_print.each do |salad| %><%= text(ApplicationController.helpers.print_format_keypair("#{salad[0]}","#{salad[1]}")) %><%= text("\n") %><% end %><% end %><% if @order.dipping_sauces_total > 0 %><%= text(ApplicationController.helpers.bold_text_for_print("\nDipping Sauces:\n"), :font_size => FONT_BIG) %><%= single_splitline %><%= text("\n") %><% @order.dipping_sauces_summary_print.each do |dipping_sauce| %><%= text(ApplicationController.helpers.print_format_keypair("#{dipping_sauce[0]}","#{dipping_sauce[1]}")) %><%= text("\n") %><% end %><% end %><% if @order.order_additional['catering_order'] == "1" %><%= text("\nDesserts:\n") %><%= single_splitline %><% @order.desserts_summary_print.each do |dessert| %><%= text(ApplicationController.helpers.print_format_keypair("#{dessert[0]}","#{dessert[1]}")) %><%= text("\n") %><% end %><% end %><% if @order.order_additional['catering_order'] == "1" %><% if @order.utensils_summary_print.count > 0 %><%= text("\nUtensils:\n") %><%= single_splitline %><% @order.utensils_summary_print.each do |utensil| %><%= text("#{utensil[0]}") %><%= text("\n") %><% end %><% end %><% end %><% end %>
<%= single_splitline %><% unless @order.special_instructions.blank? %><%= text("\nSpecial Instructions:\n", :font_size => FONT_BIG) %><%= single_splitline %><%= text("\n#{@order.special_instructions}", :font_size => FONT_BIG) %><% end %>
<%= single_splitline %>
<%= text(ApplicationController.helpers.print_format_keypair('Sub-Total:',@order.total_price_formatted)) %>
<% if @order.discount_dollar_value > 0 %><%= text(ApplicationController.helpers.print_format_keypair('discount:',@order.discount_formatted)) %><% end %>
<%= text(ApplicationController.helpers.print_format_keypair('Delivery:',@order.delivery_formatted)) %>
<% if @order.method_of_payment_id === 4 && @order.tip_amount > 0 %><%= text(ApplicationController.helpers.print_format_keypair('Tip:', @order.tip_amount_formatted)) %><% end %>
<%= text(ApplicationController.helpers.print_format_keypair('Tax:',@order.sales_tax_inc_delivery_formatted)) %>
<%= text("                                ----------") %>
<%= text(ApplicationController.helpers.print_format_keypair('TOTAL:',@order.total_price_including_sales_tax_inc_delivery_formatted)) %>
<%= text("                                ----------") %>
<%= text("Method of payment: #{@order.method_of_payment.try(:name) } ", :align_type => ALIGN_C) %>
<% if @order.method_of_payment_id === 4 && @order.franchise_location.try(:enable_online_payments) && @order.payment_transactions.count > 0 && @order.payment_transactions.last.transaction_id %>
<%= text("Paid: #{@order.payment_transactions.last.transaction_id ? 'Yes' : 'No'}") %>
<%= text("Transaction ID: #{@order.payment_transactions.last.transaction_id}") %>
<%= text("Transaction Date: #{@order.payment_transactions.last.transaction_date.to_datetime.strftime('%a %b %d, %Y at %I:%M%p')}") %>
<%= text("Paid Using: xxxx-xxxx-xxxx-#{@order.payment_transactions.last.last_four_digits}") %>
<% end %>
<%= text("Ordered from:") %>
<%= text(@order.franchise_location.address) %><%= text("\n#{@order.franchise_location.phone}") %>
<%= text("\x1b\x70\x30\xfff\x0") %>


